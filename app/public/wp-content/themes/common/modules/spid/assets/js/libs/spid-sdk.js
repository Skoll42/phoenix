/*! spid-sdk-js - v2.1.7 - 2016-07-12
 * Copyright (c) 2016 Schibsted Products and Technology; */
var SPiD=function(a){function b(d){if(c[d])return c[d].exports;var e=c[d]={exports:{},id:d,loaded:!1};return a[d].call(e.exports,e,e.exports,b),e.loaded=!0,e.exports}var c={};return b.m=a,b.c=c,b.p="",b(0)}([function(a,b,c){function d(a){a.SPiD=a.SPiD||this,a.SPiD.Talk=c(10)}function e(a,b){n.init(a),n.options().noGlobalExport||d.call(this,window),o=!0,b&&b()}function f(a){a=a||function(){};var b=this,c=function(a,b){return!a&&!!b.result||n.options().cache&&n.options().cache.hasSession},d=function(a){return n.options().cache&&n.options().cache.hasSession&&n.options().cache.hasSession.ttlSeconds?n.options().cache.hasSession.ttlSeconds:a.expiresIn},e=q.makeAsync(function(b,c){!b&&c.result&&u.tryVarnishCookie(c),s.session(p,c),p=c,a(b,c)}),f=function(a,b){c(a,b)&&t.set(b,d(b)),e(a,b)},g=function(a,c){return a&&"LoginException"===a.type?(r.fire("SPiD.loginException"),w.request(b.coreEndpoint(),null,{autologin:1},f)):(a&&r.fire("SPiD.error",a),void f(a,c))},h=t.get();return h?e(null,h):void w.request(this.sessionEndpoint(),null,{autologin:1},g)}function g(a,b){if(b=q.makeAsync(b||function(){}),v.enabled()){var c=v.get("prd_{id}".replace("{id}",a));if(c&&c.refreshed+n.options().refresh_timeout>q.now())return b(null,c)}var d=function(c,d){v.enabled()&&!c&&d.result&&(d.refreshed=q.now(),v.set("prd_{id}".replace("{id}",a),d)),!c&&d.result&&r.fire("SPiD.hasProduct",{productId:a,result:d.result}),b(c,d)};w.request(this.server(),"ajax/hasproduct.js",{product_id:a},d)}function h(a,b){if(b=q.makeAsync(b||function(){}),v.enabled()){var c=v.get("sub_{id}".replace("{id}",a));if(c&&c.refreshed+n.options().refresh_timeout>q.now())return b(null,c)}var d=function(c,d){v.enabled()&&!c&&d.result&&(d.refreshed=q.now(),v.set("sub_{id}".replace("{id}",a),d)),!c&&d.result&&r.fire("SPiD.hasSubscription",{subscriptionId:a,result:d.result}),b(c,d)};w.request(this.server(),"ajax/hassubscription.js",{product_id:a},d)}function i(a,b){b=b||function(){},w.request(this.server(),"ajax/traits.js",{t:a},b)}function j(){t.clear(),u.clearVarnishCookie()}function k(a){var b=function(b,c){c.result&&j(),!b&&c.result&&r.fire("SPiD.logout",c),a&&a(b,c)};w.request(this.server(),"ajax/logout.js",{},b)}function l(a){var b=this,c=function(){j(),b.hasSession(a)};w.request(this.server(),"ajax/acceptAgreement.js",{},c)}var m="2.1.7",n=c(1),o=!1,p={},q=c(2),r=c(4),s=c(5),t=c(6),u=c(8),v=c(9),w=c(10);q.makeAsync(function(){"function"!=typeof window.asyncSPiD||window.asyncSPiD.hasRun||(window.asyncSPiD(),window.asyncSPiD.hasRun=!0)})(),a.exports={version:function(){return m},initiated:function(){return o},server:function(){return(n.options().https?"https":"http")+"://"+n.options().server+"/"},sessionEndpoint:function(){return(n.options().https?"https":"http")+"://"+(n.options().useSessionCluster?"session."+n.options().server+"/rpc/hasSession.js":n.options().server+"/ajax/hasSession.js")},coreEndpoint:function(){return(n.options().https?"https":"http")+"://"+n.options().server+"/ajax/hasSession.js"},acceptAgreement:l,event:r,sessionCache:t,init:e,hasSession:f,hasProduct:g,hasSubscription:h,setTraits:i,logout:k}},function(a,b,c){var d={},e={server:null,client_id:null,cache:!1,logging:!1,useSessionCluster:!0,https:!0,setVarnishCookie:null,storage:"localstorage",timeout:15e3,refresh_timeout:9e5,varnish_expiration:null},f=c(2);a.exports={options:function(){return d},init:function(a){if(d=f.copy(a,e),!d.server)throw new TypeError("[SPiD] server parameter is required");if(!d.client_id)throw new TypeError("[SPiD] client_id parameter is required");d.refresh_timeout<=6e4&&(d.refresh_timeout=6e4)},server:function(){return(d.https?"https":"http")+"://"+d.server+"/"}}},function(a,b,c){function d(a,b){for(var c in b)void 0===a[c]&&(a[c]=b[c]);return a}function e(){return(new Date).getTime()}function f(a,b,c){var d=[];for(var e in c)c[e]&&d.push(e+"="+c[e]);var f=a+(b||"")+"?"+d.join("&");return h.info("SPiD.Util.buildUri() built {u}".replace("{u}",f)),f}function g(a){return function(){var b=arguments;setTimeout(function(){a.apply(null,b)},0)}}var h=c(3);a.exports={copy:d,now:e,buildUri:f,makeAsync:g}},function(a,b,c){function d(){var a=c(1);return!(!window.console||!a.options().logging&&-1===window.location.toString().indexOf("spid_debug=1"))}function e(a,b){d()&&window.console[b]("[SPiD] "+a)}function f(a){e(a,"info")}function g(a){e(a,"error")}a.exports={enabled:d,info:f,error:g}},function(a,b,c){function d(a,b){h.info("SPiD.Event.subscribe({n})".replace("{n}",a)),g[a]||(g[a]=[]),g[a].push(b)}function e(a,b){h.info("SPiD.Event.unsubscribe({n})".replace("{n}",a));for(var c=g[a]||[],d=0,e=c.length;d!==e;d++)c[d]===b&&(c[d]=null)}function f(){var a=Array.prototype.slice.call(arguments),b=a.shift();h.info("SPiD.Event.fire({n})".replace("{n}",b));for(var c=g[b]||[],d=0,e=c.length;d!==e;d++)c[d]&&c[d].apply(this,a)}var g={},h=c(3);a.exports={subscribe:d,unsubscribe:e,fire:f}},function(a,b,c){function d(a,b){b.visitor&&e.fire("SPiD.visitor",b.visitor),b.userId&&a.userId!==b.userId&&e.fire("SPiD.login",b),a.userId&&!b.userId&&e.fire("SPiD.logout",b),a.userId&&b.userId&&a.userId!==b.userId&&e.fire("SPiD.userChange",b),(b.userId||a.userId)&&e.fire("SPiD.sessionChange",b),b.userId||a.userId||e.fire("SPiD.notLoggedin",b),b.userId&&!f&&(f=!0,e.fire("SPiD.sessionInit",b)),b.userStatus!==g&&(g=b.userStatus,e.fire("SPiD.statusChange",b))}var e=c(4),f=!1,g="unknown";a.exports={session:d}},function(a,b,c){function d(){var a={localstorage:c(7),cookie:c(8),standard:{get:g,set:g,clear:g}};return a[f.options().storage||"standard"]}function e(){var a=f.options();return"spid_js_"+a.client_id}var f=c(1),g=function(){};a.exports={get:function(){return d().get(e())},set:function(a,b){return d().set(e(),a,b)},clear:function(){return d().clear(e())}}},function(a,b,c){function d(a){return JSON.parse(a)}function e(a){return JSON.stringify(a)}function f(a,b,c){try{if(c){var d=new Date;d.setTime(d.getTime()+1e3*c),b._expires=d}window.localStorage.setItem(a,e(b))}catch(f){j.info(f)}}function g(a){try{window.localStorage.removeItem(a)}catch(b){j.info(b)}}function h(a){return a&&a._expires?new Date(a._expires).getTime()<(new Date).getTime():!1}function i(a){try{var b=d(window.localStorage.getItem(a));return h(b)?(g(a),null):b}catch(c){j.info(c)}return null}var j=c(3),k=!0;a.exports={set:f,get:i,clear:g,enabled:k}},function(a,b,c){function d(a){return JSON.parse(window.unescape(a))}function e(a){return window.escape(JSON.stringify(a))}function f(a,b,c,d){var e=new Date;e.setTime(e.getTime()+1e3*c);var f="{n}={v}; expires={e}; path=/; domain=.{d}".replace("{n}",a).replace("{v}",b).replace("{e}",e.toUTCString()).replace("{d}",d);document.cookie=f}function g(a,b){var c=b.varnish_expiration||a.expiresIn;f(n,a.sp_id,c,a.baseDomain),o.info("SPiD.Cookie.set({n})".replace("{n}",n))}function h(a){var b=p.options();a.sp_id&&(b.setVarnishCookie===!0||"cookie"===b.storage&&b.setVarnishCookie!==!1)&&g(a,b)}function i(){f(n,"",0,m)}function j(a,b,c){return b?(m=b.baseDomain,f(a,e(b),c,m),void o.info("SPiD.Cookie.set({n})".replace("{n}",a))):!1}function k(a){o.info("SPiD.Cookie.get()");var b="; "+document.cookie,c=b.split("; "+a+"="),e=2===c.length?c.pop().split(";").shift():null;if(e){var f=d(e);return f.expiresIn=parseInt(f.expiresIn,10),f.clientTime=parseInt(f.clientTime,10),m=f.baseDomain,f}return null}function l(a){o.info("SPiD.Cookie.clear()"),f(a,"",0,m),i()}var m=document.domain,n="SP_ID",o=c(3),p=c(1);a.exports={decode:d,encode:e,set:j,tryVarnishCookie:h,clearVarnishCookie:i,get:k,clear:l,name:name}},function(a,b,c){function d(a){return JSON.parse(window.unescape(a))}function e(a){return window.escape(JSON.stringify(a))}function f(){return!!k.options().cache}function g(a,b){f()&&(j[a]=e(b))}function h(a){return f()?j[a]?d(j[a]):null:void 0}function i(a){f()&&j[a]&&(j[a]=null)}var j={},k=c(1);a.exports={decode:d,encode:e,enabled:f,set:g,get:h,clear:i}},function(a,b,c){function d(){return"f"+(Math.random()*(1<<30)).toString(16).replace(".","")}function e(a){var b=d();return q[b]=function(b,c){a(b,c)},b}function f(a,b){r.push({id:a,url:b})}function g(){return null!==s}function h(){p&&(p.parentNode.removeChild(p),p=null)}function i(a,b){if(window.clearTimeout(s),s=null,h(),m(),q[a]){var c=q[a];q[a]=null;var d=b.error?b.error:null,e=b.response?b.response:b;c(d,e)}}function j(a,b){u.error(a),i(b,{error:{type:"communication",code:503,description:a},response:{}})}function k(a){p=document.createElement("SCRIPT"),p.src=a.url,p.type="text/javascript",p.onerror=function(){j("Browser triggered error",a.id)};var b=document.getElementsByTagName("HEAD")[0];b.appendChild(p)}function l(a){var b=c(1).options();k(a),s=window.setTimeout(function(){j("Timeout reached",a.id)},b.timeout)}function m(){if(!g()&&r.length>0){var a=r.shift();l(a)}}function n(a,b,c,d){var g=e(d);c=c||{},c.callback=g,c.redirect_uri=t,c.client_id=w.options().client_id;var h=v.buildUri(a,b,c);u.info("Request: "+h),f(g,h),m()}function o(a,b){u.info("Response received"),i(a,b)}var p,q={},r=[],s=null,t=encodeURIComponent(window.location.toString()),u=c(3),v=c(2),w=c(1);a.exports={request:n,response:o}}]);